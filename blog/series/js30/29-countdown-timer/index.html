<!DOCTYPE html>
<html lang="en">
<head>
    
  
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel="alternate" href="/rss.xml" type="application/rss+xml" title="RSS">
        <link rel="icon" type="image/x-icon" href="/assets/img/dd-logo.ico">
        <link rel="shortcut icon" type="img/ico" href="/assets/img/dd-logo.ico">
        <link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet">
        <link rel="stylesheet" href="/css/vendor/normalize.css">
        <link rel="stylesheet" href="/css/vendor/grid.css">
        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="/css/queries.css">
        <meta property="og:title" content="DiscoverDev | Daily digest of engineering blog posts for software developers" />
        <meta property="og:image" content="https://i.lensdump.com/i/uYTND.png" />
        <title>Discover dev</title>
        <script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102291280-1', 'auto');
              ga('send', 'pageview');

        </script>
    
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://discoverdev.io/blog/series/js30/29-countdown-timer" />
  <meta property="og:description" content="This is the 29th project of WesBos's JS30 series. Today we'll build a custom JavaScript countdown timer from scratch.
" />
  <link rel="stylesheet" href="/css/blog-post.css">
  <link rel="stylesheet" href="/css/blog-mail.css">
  <link rel="stylesheet" href="/css/blog-md.css">
  <link rel="stylesheet" href="/css/code-highlight.css">

</head>

<body>
<header class="clearfix">
  
    <div class="logo"><a href="/"><img src="/assets/img/dd-logo-and-text.svg" alt=""></a> </div>
    <nav>
        <ul>
        <li><a href="/tags/">/tags</a></li>
        <li><a href="/archive.html">/archive</a></li>
        <li><a href="/about.html">/about</a></li>
        <li><a href="mailto:makers@discoverdev.io" target="_blank">/contact-us</a></li>
        <li><a href="/subscribe.html" class="highlight">/Subscribe</a></li>
        </ul>
    </nav>
  
</header>


<main>
<div class="bpost-wrapper clearfix">
  
  <article class="bpost-content">
    <header><h1 class="bpost-title">Countdown timer</h1></header>
    <!-- Probably date and author card here -->

    <section class="md-content-render">
      <p>This is the 29th project of WesBos's <a href="https://javascript30.com/friend/DISCOVERDEV">JS30 series</a>. To see the <strong>whole 30 part series</strong>, <a href="../">click here</a>
Today we'll build a custom JavaScript countdown timer from scratch.</p>

<p>Video -</p>

<p><style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style><div class='embed-container'><iframe src='https://www.youtube.com/embed/LAaf7-WuJJQ' frameborder='0' allowfullscreen></iframe></div></p>

<p>Starter code -</p>

<iframe height='460' scrolling='no' title='JS30-29-timer-a' src='//codepen.io/deepakkarki/embed/JZeLBw/?height=360&theme-id=dark&default-tab=css,result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/deepakkarki/pen/JZeLBw/'>JS30-29-timer-a</a> by Deepak Karki (<a href='https://codepen.io/deepakkarki'>@deepakkarki</a>) on <a href='https://codepen.io'>CodePen</a>.
</iframe>

<p>All the HTML and CSS is already given to us,</p>

<div class="codehilite"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;timer&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;timer__controls&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">data-time</span><span class="o">=</span><span class="s">&quot;20&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;timer__button&quot;</span><span class="p">&gt;</span>20 Secs<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    ...
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;customForm&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;custom&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;minutes&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Enter Minutes&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display__time-left&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;display__end-time&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>

<p>This is the HTML display, <code>div.timer__controls</code> holds all the buttons and the form for custom entering the minutes. The <code>data-time</code> attribute hold the time in seconds that the corresponding button sets.</p>

<p><code>h1.display__time-left</code> is the countdown display, <code>p.display__end-time</code> displays the end time when the count down will run out.</p>

<hr />

<p>We may be initially tempted to just use <code>setInterval()</code> and update the countdown, it'll work in most cases, but it isn't reliable. If the browser is minimized or if there are other computation heavy function blocking the event loop, the interval callback may not be called to the second. Hence we take a different approach. We'll have the callback check the remaining time by comparing to the current time.</p>

<div class="codehilite"><pre><span></span><code><span class="c1">//handles to displays and controls</span>
<span class="kr">const</span> <span class="nx">timerDisplay</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.display__time-left&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">endTime</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.display__end-time&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">buttons</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;[data-time]&#39;</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">countdown</span><span class="p">;</span> <span class="c1">// this is the ret value if setInterval</span>

<span class="kd">function</span> <span class="nx">timer</span><span class="p">(</span><span class="nx">seconds</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// clear any existing timers</span>
  <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">countdown</span><span class="p">);</span>

  <span class="kr">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
  <span class="c1">// convert seconds to mili seconds</span>
  <span class="kr">const</span> <span class="nx">then</span> <span class="o">=</span> <span class="nx">now</span> <span class="o">+</span> <span class="p">(</span><span class="nx">seconds</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="nx">displayTimeLeft</span><span class="p">(</span><span class="nx">seconds</span><span class="p">);</span>

  <span class="nx">countdown</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">secondsLeft</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nx">then</span> <span class="o">-</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">())</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="c1">// check if we should stop the countdown</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">secondsLeft</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">countdown</span><span class="p">);</span>
    <span class="c1">// else display secondsLeft</span>
    <span class="k">else</span> <span class="nx">displayTimeLeft</span><span class="p">(</span><span class="nx">secondsLeft</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">displayTimeLeft</span><span class="p">(</span><span class="nx">seconds</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//display logic</span>
<span class="p">}</span>
</code></pre></div>

<p>Well we did quite a few things here, lets see what we have!</p>

<p>The <code>timer(sec)</code> function sets a timer for <code>sec</code> seconds. <code>now</code> is the time (in mili seconds) the timer is being set, <code>then</code> is the time when the timer will run out. </p>

<p>We have a <code>setInterval</code> which is supposed to run every second, even if the callback is missed, no issues since we're calculating the seconds left using the final time <code>then</code> and the time the callback runs. That's how we get <code>secondsLeft = Math.round((then - Date.now()) / 1000)</code></p>

<p>We call <code>displayTimeLeft</code> with the initial number of seconds in <code>timer()</code>, then it is called in the <code>setInterval</code> callback to display <code>secondsLeft</code>.</p>

<p>Once the <code>secondsLeft</code> gets lesser than zero, the interval is cleared.</p>

<p>Now for the seconds left display logic -</p>

<div class="codehilite"><pre><span></span><code><span class="kd">function</span> <span class="nx">displayTimeLeft</span><span class="p">(</span><span class="nx">seconds</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">minutes</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">seconds</span> <span class="o">/</span> <span class="mi">60</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">remainderSeconds</span> <span class="o">=</span> <span class="nx">seconds</span> <span class="o">%</span> <span class="mi">60</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">display</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">minutes</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">remainderSeconds</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">?</span> <span class="s1">&#39;0&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="si">}${</span><span class="nx">remainderSeconds</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">display</span><span class="p">;</span>
  <span class="nx">timerDisplay</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">display</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>From the seconds, extract the whole minutes, then find the reminder seconds. In the display we check if <code>remainderSeconds</code> is a single digit, if so we pad it with a extra '0'. We then update the <code>h1.display__time-left</code> and the title of the page with <code>display</code>. The title of the page is displayed in the browser tab area.</p>

<p>Now to display the end time (just under the count down timer display). </p>

<div class="codehilite"><pre><span></span><code><span class="c1">// in timer()</span>
<span class="nx">displayEndTime</span><span class="p">(</span><span class="nx">then</span><span class="p">)</span>

<span class="kd">function</span> <span class="nx">displayEndTime</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">end</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">hour</span> <span class="o">=</span> <span class="nx">end</span><span class="p">.</span><span class="nx">getHours</span><span class="p">();</span>
  <span class="kr">const</span> <span class="nx">adjustedHour</span> <span class="o">=</span> <span class="nx">hour</span> <span class="o">&gt;</span> <span class="mi">12</span> <span class="o">?</span> <span class="nx">hour</span> <span class="o">-</span> <span class="mi">12</span> <span class="o">:</span> <span class="nx">hour</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">minutes</span> <span class="o">=</span> <span class="nx">end</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">();</span>
  <span class="kr">const</span> <span class="nx">adjustedMinutes</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">minutes</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">?</span> <span class="s1">&#39;0&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="si">}${</span><span class="nx">minutes</span><span class="si">}</span><span class="sb">`</span>
  <span class="nx">endTime</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="sb">`Be Back At </span><span class="si">${</span><span class="nx">adjustedHour</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">adjustedMinutes</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><code>displayEndTime(endTime)</code> gets the end time in ms as a parameter. We extract the hour, convert it to 12 hour format. Get the minutes, again if it is in single digits, pad it with an extra zero. Display the result in <code>p.display__end-time</code></p>

<p>Now to get the user input to set the timer.</p>

<p>For each of the buttons we get the necessary time from <code>data-time</code> attribute and make a call to <code>timer()</code>. This is very straightforward.</p>

<div class="codehilite"><pre><span></span><code><span class="kd">function</span> <span class="nx">startTimer</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">seconds</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">time</span><span class="p">);</span>
  <span class="nx">timer</span><span class="p">(</span><span class="nx">seconds</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">buttons</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">button</span> <span class="p">=&gt;</span> <span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">startTimer</span><span class="p">));</span>
</code></pre></div>

<p>The form component is a bit more involved. We listen to when the user 'submits' the form, i.e. type the number and press enter.</p>

<div class="codehilite"><pre><span></span><code><span class="nb">document</span><span class="p">.</span><span class="nx">customForm</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="kr">const</span> <span class="nx">mins</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">minutes</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
  <span class="nx">timer</span><span class="p">(</span><span class="nx">mins</span> <span class="o">*</span> <span class="mi">60</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p>We prevent the default action, get the value (represents minutes) from the text input and then call the timer. We then reset the form to empty the text field.</p>

<p>This completes our count down timer project, here is the final code -</p>

<iframe height='435' scrolling='no' title='JS30-29-timer-b' src='//codepen.io/deepakkarki/embed/EROeQq/?height=435&theme-id=dark&default-tab=js,result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/deepakkarki/pen/EROeQq/'>JS30-29-timer-b</a> by Deepak Karki (<a href='https://codepen.io/deepakkarki'>@deepakkarki</a>) on <a href='https://codepen.io'>CodePen</a>.
</iframe>

    </section>

    <section class="bpost-email-footer">
      <div class="blog-email-signup">

  <h2> STAY UPDATED </h2>

  <p class="signup-msg">
    Join 5000+ fellow software engineers and keep up with the top engineering content from companies all over the world. Carefully handpicked and delivered to your mailbox every week!<br>
  </p>

  <form action="https://discoverdev.us16.list-manage.com/subscribe/post" method="POST">
    <input type="hidden" name="u" value="c32352dc58bef5cdd7821a012">
    <input type="hidden" name="id" value="6aab40a607">
    
    <input type="email" autocapitalize="off" autocorrect="off" name="MERGE0" id="MERGE0" class="email" size="25" placeholder="Email" value="">
    <input type="submit" value="Subscribe">
  </form>

  <p class="privacy-msg">We take your time and privacy seriously - we don't spam or share your email. Unsubscribe anytime.</p>
</div>
    </section>
  </article>

  <aside class="bpost-email">
    <div class="blog-email-signup">

  <h2> STAY UPDATED </h2>

  <p class="signup-msg">
    Join 5000+ fellow software engineers and keep up with the top engineering content from companies all over the world. Carefully handpicked and delivered to your mailbox every week!<br>
  </p>

  <form action="https://discoverdev.us16.list-manage.com/subscribe/post" method="POST">
    <input type="hidden" name="u" value="c32352dc58bef5cdd7821a012">
    <input type="hidden" name="id" value="6aab40a607">
    
    <input type="email" autocapitalize="off" autocorrect="off" name="MERGE0" id="MERGE0" class="email" size="25" placeholder="Email" value="">
    <input type="submit" value="Subscribe">
  </form>

  <p class="privacy-msg">We take your time and privacy seriously - we don't spam or share your email. Unsubscribe anytime.</p>
</div>
  </aside>

</div>


</main>


<footer>
  <p class="msg">Made with <b style="font-size:20px;"> &hearts;</b> by a group of nerds on Earth!</p>
  <p class="copyright">© Copyright 2018 Discoverdev.io</p>
</footer>
<div class="ghost-footer"></div>
</body>
</html>